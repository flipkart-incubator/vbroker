namespace com.flipkart.vbroker.entities;

enum ApiKey:byte {ProduceRequest=0, ProduceResponse=1, TopicCreateRequest=2, TopicCreateResponse=3}

union RequestMessage { ProduceRequest, TopicCreateRequest }

enum HttpMethod:byte {POST=0, PUT=1, DELETE=2, PATCH=3}

enum TopicType:byte {MAIN=0, SIDELINE=1, RETRY=2}

enum TopicCategory:byte {QUEUE=0, TOPIC=1}

table VRequest {
      version:int8;
      correlationId:int32;
      requestMessage:RequestMessage;
}

table HttpHeader {
      key:string;
      value:string;
}

table Message {
      messageId:string;
      groupId:string;
      crc:int8;
      version:int8;
      seqNo:int32;
      topicId:int16;
      attributes:int32;
      httpUri:string;
      httpMethod:HttpMethod;
      callbackTopicId:int16;
      callbackHttpUri:string;
      callbackHttpMethod:HttpMethod;
      headers:[HttpHeader];
      bodyLength:int32;
      bodyPayload:[int8];
}

table MessageSet {
      messages:[Message];
}

table ProduceRequest {
      topicId:int16;
      partitionId:int16;
      requiredAcks:int16;
      messageSet:MessageSet;
}

table TopicCreateRequest {
      topicName:string;
      team:string;
      grouped:bool;
      partitions:int32;
      replicationFactor:int32;
      topicType:TopicType;
      topicCategory:TopicCategory;
}

root_type VRequest;
